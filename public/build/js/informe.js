!function(){!async function(){try{const n=`/api/informes?id=${i()}`,t=await fetch(n),a=await t.json();e=a.informe,o()}catch(e){console.log(e)}}();let e=[];const n="location.origin";function o(){if(function(){const e=document.querySelector("#listado-informes");for(;e.firstChild;)e.removeChild(e.firstChild)}(),0===e.length){const e=document.querySelector("#noInfomre"),n=document.createElement("P");return n.textContent="No hay Informes",n.classList.add("no-informes"),void e.appendChild(n)}const n={0:"Pendiente",1:"Entregado"};e.forEach((e=>{document.querySelector("#tabla").classList.add("mostrar");const o=document.createElement("TR");o.dataset.informeId=e.id;const a=document.createElement("TD");a.textContent=e.folio,a.classList.add("pointer"),a.ondblclick=function(){t(!0,{...e})};const i=document.createElement("TD");i.textContent=e.fechaGen;const c=document.createElement("TD");c.textContent=e.modelo;const l=document.createElement("TD");l.textContent=e.serie;const d=document.createElement("TD");d.textContent=e.noParte;const s=document.createElement("TD");s.textContent=e.refacciones;const m=document.createElement("TD");m.textContent=e.falla;const f=document.createElement("TD");f.textContent=e.comentarios;const u=document.createElement("TD");u.textContent=e.contador;const p=document.createElement("TD");p.textContent=e.fechaEnt;const h=document.createElement("BUTTON");h.classList.add("estado-informe"),h.classList.add(`${n[e.status].toLowerCase()}`),h.textContent=n[e.status],h.dataset.estadoInforme=e.status,h.ondblclick=function(){!function(e){const n="1"===e.status?"0":"1";e.status=n,r(e)}({...e})},o.appendChild(a),o.appendChild(i),o.appendChild(c),o.appendChild(l),o.appendChild(d),o.appendChild(s),o.appendChild(m),o.appendChild(f),o.appendChild(u),o.appendChild(p),o.appendChild(h);document.querySelector("#listado-informes").appendChild(o)}))}function t(t=!1,c={}){const l=document.createElement("DIV");l.classList.add("modal"),l.innerHTML=`\n            <form action="" class="formulario nuevo-informe">\n                <legend>${t?"Editar Informe":"Añadir Informe"}</legend>\n\n                <div class="grid">\n                    <div class="campo">\n                        <label for="folio">Folio: </label>\n                        <input \n                            value="${c.folio?c.folio:""}"\n                            placeholder="${c.folio?"Editar Folio":"Añadir Folio"}" \n                            name="folio" \n                            id="folio" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="fechaGen">Fecha Generada: </label>\n                        <input \n                            value="${c.fechaGen?c.fechaGen:""}"\n                            placeholder="${c.fechaGen?"Editar aaaa-mm-dd":"aaaa-mm-dd"}" \n                            name="fechaGen" \n                            id="fechaGen" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="modelo">Modelo: </label>\n                        <input \n                            value="${c.modelo?c.modelo:""}"\n                            placeholder="${c.modelo?"Editar Modelo":"Añadir Modelo"}" \n                            name="modelo" \n                            id="modelo" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="serie">Serie: </label>\n                        <input \n                            value="${c.serie?c.serie:""}"\n                            placeholder="${c.serie?"Editar Serie":"Añadir Serie"}" \n                            name="serie" \n                            id="serie" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="noParte">Numero de Parte: </label>\n                        <input \n                            value="${c.noParte?c.noParte:""}"\n                            placeholder="${c.noParte?"Editar Numero de Parte":"Añadir Numero de Parte"}" \n                            name="noParte" \n                            id="noParte" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="refacciones">Refacción: </label>\n                        <input \n                            value="${c.refacciones?c.refacciones:""}"\n                            placeholder="${c.refacciones?"Editar Refacción":"Añadir Refacción"}" \n                            name="refacciones" \n                            id="refacciones" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="falla">Fallas: </label>\n                        <textarea name="falla" id="falla">${c.falla?c.falla:""}</textarea>\n                    </div>\n\n                    <div class="campo">\n                        <label for="comentarios">Comentarios: </label>\n                        <textarea name="comentarios" id="comentarios">${c.comentarios?c.comentarios:""}</textarea>\n                    </div>\n\n                    <div class="campo">\n                        <label for="contador">Contador: </label>\n                        <input \n                            value="${c.contador?c.contador:""}"\n                            placeholder="${c.contador?"Editar Contador":"Añadir Contador"}" \n                            name="contador" \n                            id="contador" \n                            type="number"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="fechaEnt">Fecha Visita: </label>\n                        <input \n                            value="${c.fechaEnt?c.fechaEnt:""}"\n                            placeholder="${c.fechaEnt?"Editar aaaa-mm-dd":"aaaa-mm-dd"}" \n                            name="fechaEnt" \n                            id="fechaEnt" \n                            type="text"\n                        >\n                    </div>\n                </div>\n\n                <div class="opciones">\n                    <input \n                        class="submit-nuevo-informe" \n                        type="submit" \n                        value="${c.folio?"Actualizar Informe":"Añadir Informe"}"\n                    >\n                    <button \n                        type="button" \n                        id="cerrar-informe" \n                        class="cerrar-informe">\n                        Cancelar\n                    </button>\n                </div>\n            </form>\n\n        `,setTimeout((()=>{document.querySelector(".formulario").classList.add("animar")}),300),l.addEventListener("click",(function(d){if(d.preventDefault(),d.target.classList.contains("cerrar-informe")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout((()=>{l.remove()}),300)}if(d.target.classList.contains("submit-nuevo-informe")){const l=document.querySelector("#folio").value.trim(),d=document.querySelector("#fechaGen").value.trim(),s=document.querySelector("#modelo").value.trim(),m=document.querySelector("#serie").value.trim(),f=document.querySelector("#noParte").value.trim(),u=document.querySelector("#refacciones").value.trim(),p=document.querySelector("#falla").value.trim(),h=document.querySelector("#comentarios").value.trim(),v=document.querySelector("#contador").value.trim(),E=document.querySelector("#fechaEnt").value.trim(),b=/^\d{4}-\d{2}-\d{2}$/;if(""===l&&""===d&&""===s&&""===m&&""===f&&""===u&&""===p&&""===h&&""===v&&""===E)return void a("Todos los campos son obligatorios");if(""===l)return void a("Es obligatorio el campo: Folio");if(""===d)return void a("Es obligatorio el campo: Fecha Generada");if(!b.test(d))return void a("Formato de fecha inválido en el campo: Fecha Generada. Por favor, use AAAA-MM-DD. Ejemplo: 2024-01-31");if(""===s)return void a("Es obligatorio el campo: Modelo");if(""===m)return void a("Es obligatorio el campo: Serie");if(""===f)return void a("Es obligatorio el campo: Numero de Parte");if(""===u)return void a("Es obligatorio el campo: Refacciones");if(""===p)return void a("Es obligatorio el campo: Falla");if(""===h)return void a("Es obligatorio el campo: Comentarios");if(""===v)return void a("Es obligatorio el campo: Contador");if(""===E)return void a("Es obligatorio el campo: Fecha Visita");if(!b.test(E))return void a("Formato de fecha inválido en el campo: Fecha Entrega. Por favor, use AAAA-MM-DD. Ejemplo: 2024-01-31");t?(c.comentarios=h,c.contador=v,c.falla=p,c.fechaEnt=E,c.fechaGen=d,c.folio=l,c.modelo=s,c.noParte=f,c.refacciones=u,c.serie=m,r(c)):async function(t,a,r,c,l,d,s,m,f,u){const p=new FormData;p.append("folio",t),p.append("fechaGen",a),p.append("modelo",r),p.append("serie",c),p.append("noParte",l),p.append("refacciones",d),p.append("falla",s),p.append("comentarios",m),p.append("contador",f),p.append("fechaEnt",u),p.append("clientes_id",i());try{const i=`${n}/api/informe`,h=await fetch(i,{method:"POST",body:p}),v=await h.json();if(function(e,n,o){const t=document.querySelector(".alerta");t&&t.remove();const a=document.createElement("DIV");a.classList.add("alerta",n),a.textContent=e,o.parentElement.insertBefore(a,o.nextElementSibling),setTimeout((()=>{a.remove()}),5e3)}(v.mensaje,v.tipo,document.querySelector(".formulario legend")),"exito"===v.tipo){const n=document.querySelector(".modal");setTimeout((()=>{n.remove()}),1500);const i={id:String(v.id),folio:t,fechaGen:a,modelo:r,serie:c,noParte:l,refacciones:d,falla:s,comentarios:m,contador:f,fechaEnt:u,status:"0",clientes_id:v.clientes_id};e=[...e,i],o()}}catch(e){console.log(e)}}(l,d,s,m,f,u,p,h,v,E)}})),document.querySelector(".dashboard").appendChild(l)}function a(e){Swal.fire({icon:"error",title:"Oops...",text:e})}async function r(t){const{clientes_id:r,comentarios:c,contador:l,falla:d,fechaEnt:s,fechaGen:m,folio:f,id:u,modelo:p,noParte:h,refacciones:v,serie:E,status:b}=t,y=new FormData;y.append("comentarios",c),y.append("contador",l),y.append("falla",d),y.append("fechaEnt",s),y.append("fechaGen",m),y.append("folio",f),y.append("id",u),y.append("modelo",p),y.append("noParte",h),y.append("refacciones",v),y.append("serie",E),y.append("status",b),y.append("clientes_id",i());try{const t=`${n}/api/informe/actualizar`,r=await fetch(t,{method:"POST",body:y}),i=await r.json();if("error"===i.respuesta.tipo)a(i.mensaje);else if("exito"===i.respuesta.tipo){C=i.respuesta.mensaje,Swal.fire({position:"center",icon:"success",title:C,showConfirmButton:!1,timer:1500});const n=document.querySelector(".modal");n&&n.remove(),e=e.map((e=>(e.id===u&&(e.status=b,e.comentarios=c,e.contador=l,e.falla=d,e.fechaEnt=s,e.fechaGen=m,e.folio=f,e.modelo=p,e.noParte=h,e.refacciones=v,e.serie=E),e))),o()}}catch(e){console.log(e)}var C}function i(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}document.querySelector("#agregar-informe").addEventListener("click",(function(){t(!1)}))}();