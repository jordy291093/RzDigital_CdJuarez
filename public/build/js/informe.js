!function(){!async function(){try{const o=`/api/informes?id=${r()}`,t=await fetch(o),a=await t.json();e=a.informe,n()}catch(e){console.log(e)}}();let e=[];function n(){if(function(){const e=document.querySelector("#listado-informes");for(;e.firstChild;)e.removeChild(e.firstChild)}(),0===e.length){const e=document.querySelector("#noInfomre"),n=document.createElement("P");return n.textContent="No hay Informes",n.classList.add("no-informes"),void e.appendChild(n)}const n={0:"Pendiente",1:"Entregado"};e.forEach((e=>{document.querySelector("#tabla").classList.add("mostrar");const t=document.createElement("tr");t.dataset.informeId=e.id;const r=document.createElement("TD");r.textContent=e.folio,r.classList.add("pointer"),r.ondblclick=function(){o(!0,{...e})};const i=document.createElement("TD");i.textContent=e.fechaGen;const c=document.createElement("TD");c.textContent=e.modelo;const l=document.createElement("TD");l.textContent=e.serie;const d=document.createElement("TD");d.textContent=e.noParte;const s=document.createElement("TD");s.textContent=e.refacciones;const m=document.createElement("TD");m.textContent=e.falla;const f=document.createElement("TD");f.textContent=e.comentarios;const u=document.createElement("TD");u.textContent=e.contador;const p=document.createElement("TD");p.textContent=e.fechaEnt;const h=document.createElement("BUTTON");h.classList.add("estado-informe"),h.classList.add(`${n[e.status].toLowerCase()}`),h.textContent=n[e.status],h.dataset.estadoInforme=e.status,h.ondblclick=function(){!function(e){const n="1"===e.status?"0":"1";e.status=n,a(e)}({...e})},t.appendChild(r),t.appendChild(i),t.appendChild(c),t.appendChild(l),t.appendChild(d),t.appendChild(s),t.appendChild(m),t.appendChild(f),t.appendChild(u),t.appendChild(p),t.appendChild(h);document.querySelector("#listado-informes").appendChild(t)}))}function o(o=!1,i={}){const c=document.createElement("DIV");c.classList.add("modal"),c.innerHTML=`\n            <form action="" class="formulario nuevo-informe">\n                <legend>${o?"Editar Informe":"Añadir Informe"}</legend>\n\n                <div class="grid">\n                    <div class="campo">\n                        <label for="folio">Folio: </label>\n                        <input \n                            value="${i.folio?i.folio:""}"\n                            placeholder="${i.folio?"Editar Folio":"Añadir Folio"}" \n                            name="folio" \n                            id="folio" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="fechaGen">Fecha Generada: </label>\n                        <input \n                            value="${i.fechaGen?i.fechaGen:""}"\n                            placeholder="${i.fechaGen?"Editar aaaa-mm-dd":"aaaa-mm-dd"}" \n                            name="fechaGen" \n                            id="fechaGen" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="modelo">Modelo: </label>\n                        <input \n                            value="${i.modelo?i.modelo:""}"\n                            placeholder="${i.modelo?"Editar Modelo":"Añadir Modelo"}" \n                            name="modelo" \n                            id="modelo" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="serie">Serie: </label>\n                        <input \n                            value="${i.serie?i.serie:""}"\n                            placeholder="${i.serie?"Editar Serie":"Añadir Serie"}" \n                            name="serie" \n                            id="serie" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="noParte">Numero de Parte: </label>\n                        <input \n                            value="${i.noParte?i.noParte:""}"\n                            placeholder="${i.noParte?"Editar Numero de Parte":"Añadir Numero de Parte"}" \n                            name="noParte" \n                            id="noParte" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="refacciones">Refacción: </label>\n                        <input \n                            value="${i.refacciones?i.refacciones:""}"\n                            placeholder="${i.refacciones?"Editar Refacción":"Añadir Refacción"}" \n                            name="refacciones" \n                            id="refacciones" \n                            type="text"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="falla">Fallas: </label>\n                        <textarea name="falla" id="falla">${i.falla?i.falla:""}</textarea>\n                    </div>\n\n                    <div class="campo">\n                        <label for="comentarios">Comentarios: </label>\n                        <textarea name="comentarios" id="comentarios">${i.comentarios?i.comentarios:""}</textarea>\n                    </div>\n\n                    <div class="campo">\n                        <label for="contador">Contador: </label>\n                        <input \n                            value="${i.contador?i.contador:""}"\n                            placeholder="${i.contador?"Editar Contador":"Añadir Contador"}" \n                            name="contador" \n                            id="contador" \n                            type="number"\n                        >\n                    </div>\n\n                    <div class="campo">\n                        <label for="fechaEnt">Fecha Entrega: </label>\n                        <input \n                            value="${i.fechaEnt?i.fechaEnt:""}"\n                            placeholder="${i.fechaEnt?"Editar aaaa-mm-dd":"aaaa-mm-dd"}" \n                            name="fechaEnt" \n                            id="fechaEnt" \n                            type="text"\n                        >\n                    </div>\n                </div>\n\n                <div class="opciones">\n                    <input \n                        class="submit-nuevo-informe" \n                        type="submit" \n                        value="${i.folio?"Actualizar Informe":"Añadir Informe"}"\n                    >\n                    <button \n                        type="button" \n                        id="cerrar-informe" \n                        class="cerrar-informe">\n                        Cancelar\n                    </button>\n                </div>\n            </form>\n\n        `,setTimeout((()=>{document.querySelector(".formulario").classList.add("animar")}),300),c.addEventListener("click",(function(l){if(l.preventDefault(),l.target.classList.contains("cerrar-informe")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout((()=>{c.remove()}),300)}if(l.target.classList.contains("submit-nuevo-informe")){const c=document.querySelector("#folio").value.trim(),l=document.querySelector("#fechaGen").value,d=document.querySelector("#modelo").value,s=document.querySelector("#serie").value,m=document.querySelector("#noParte").value,f=document.querySelector("#refacciones").value,u=document.querySelector("#falla").value,p=document.querySelector("#comentarios").value,h=document.querySelector("#contador").value,v=document.querySelector("#fechaEnt").value,E=/^\d{4}-\d{2}-\d{2}$/;if(""===c&&""===l&&""===d&&""===s&&""===m&&""===f&&""===u&&""===p&&""===h&&""===v)return void t("Todos los campos son obligatorios");if(""===c)return void t("Es obligatorio el campo: Folio");if(""===l)return void t("Es obligatorio el campo: Fecha Generada");if(!E.test(l))return void t("Formato de fecha inválido en el campo: Fecha Generada. Por favor, use AAAA-MM-DD. Ejemplo: 2024-01-31");if(""===d)return void t("Es obligatorio el campo: Modelo");if(""===s)return void t("Es obligatorio el campo: Serie");if(""===m)return void t("Es obligatorio el campo: Numero de Parte");if(""===f)return void t("Es obligatorio el campo: Refacciones");if(""===u)return void t("Es obligatorio el campo: Falla");if(""===p)return void t("Es obligatorio el campo: Comentarios");if(""===h)return void t("Es obligatorio el campo: Contador");if(""===v)return void t("Es obligatorio el campo: Fecha Entrega");if(!E.test(v))return void t("Formato de fecha inválido en el campo: Fecha Entrega. Por favor, use AAAA-MM-DD. Ejemplo: 2024-01-31");o?(i.comentarios=p,i.contador=h,i.falla=u,i.fechaEnt=v,i.fechaGen=l,i.folio=c,i.modelo=d,i.noParte=m,i.refacciones=f,i.serie=s,a(i)):async function(o,t,a,i,c,l,d,s,m,f){const u=new FormData;u.append("folio",o),u.append("fechaGen",t),u.append("modelo",a),u.append("serie",i),u.append("noParte",c),u.append("refacciones",l),u.append("falla",d),u.append("comentarios",s),u.append("contador",m),u.append("fechaEnt",f),u.append("clientes_id",r());try{const r="http://localhost:3000/api/informe",p=await fetch(r,{method:"POST",body:u}),h=await p.json();if(function(e,n,o){const t=document.querySelector(".alerta");t&&t.remove();const a=document.createElement("DIV");a.classList.add("alerta",n),a.textContent=e,o.parentElement.insertBefore(a,o.nextElementSibling),setTimeout((()=>{a.remove()}),5e3)}(h.mensaje,h.tipo,document.querySelector(".formulario legend")),"exito"===h.tipo){const r=document.querySelector(".modal");setTimeout((()=>{r.remove()}),1500);const u={id:String(h.id),folio:o,fechaGen:t,modelo:a,serie:i,noParte:c,refacciones:l,falla:d,comentarios:s,contador:m,fechaEnt:f,status:"0",clientes_id:h.clientes_id};e=[...e,u],n()}}catch(e){console.log(e)}}(c,l,d,s,m,f,u,p,h,v)}})),document.querySelector(".dashboard").appendChild(c)}function t(e){Swal.fire({icon:"error",title:"Oops...",text:e})}async function a(o){const{clientes_id:t,comentarios:a,contador:i,falla:c,fechaEnt:l,fechaGen:d,folio:s,id:m,modelo:f,noParte:u,refacciones:p,serie:h,status:v}=o,E=new FormData;E.append("comentarios",a),E.append("contador",i),E.append("falla",c),E.append("fechaEnt",l),E.append("fechaGen",d),E.append("folio",s),E.append("id",m),E.append("modelo",f),E.append("noParte",u),E.append("refacciones",p),E.append("serie",h),E.append("status",v),E.append("clientes_id",r());try{const o="http://localhost:3000/api/informe/actualizar",t=await fetch(o,{method:"POST",body:E}),r=await t.json();if("exito"===r.respuesta.tipo){Swal.fire({position:"center",icon:"success",title:r.respuesta.mensaje,showConfirmButton:!1,timer:1500});const o=document.querySelector(".modal");o&&o.remove(),e=e.map((e=>(e.id===m&&(e.status=v,e.comentarios=a,e.contador=i,e.falla=c,e.fechaEnt=l,e.fechaGen=d,e.folio=s,e.modelo=f,e.noParte=u,e.refacciones=p,e.serie=h),e))),n()}}catch(e){console.log(e)}}function r(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}document.querySelector("#agregar-informe").addEventListener("click",(function(){o(!1)}))}();